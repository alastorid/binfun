#include <stdio.h>
#include <sys/mman.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
unsigned char x[] = {
  0x55, 0x48, 0x89, 0xe5, 0x48, 0x89, 0x7d, 0xf8, 0x48, 0x8b, 0x45, 0xf8,
  0x8b, 0x00, 0x8d, 0x50, 0x01, 0x48, 0x8b, 0x45, 0xf8, 0x89, 0x10, 0xb8,
  0x00, 0x00, 0x00, 0x00, 0x5d, 0xc3, 0x55, 0x48
};
int main()
{
  int (*f)(int*);
  int a;  
  char *exe=mmap(NULL, getpagesize(), PROT_READ | PROT_WRITE | PROT_EXEC, MAP_ANONYMOUS | MAP_SHARED, -1, 0);
  memcpy(exe,x,32);
  a=0;
  f=(void*)exe;
  printf("a=%d\n",a);
  f(&a);
  printf("a=%d\n",a);
  return 0;
}
